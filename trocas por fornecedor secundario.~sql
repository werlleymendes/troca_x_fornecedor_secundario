SET SERVEROUTPUT ON;
DECLARE 

BEGIN
              FOR i in (SELECT DISTINCT g.seqpessoa FROM consinco.mlf_nfitem g)
                LOOP
                  FOR ITEM IN(
                              SELECT DISTINCT c.nroempresa, e.seqpessoa, e.fantasia fornecedor, b.seqproduto, b.desccompleta produto, 
                                     c.estqtroca ESTOQUE_TROCA, (c.cmultvlrnf * c.estqtroca) VLR_ESTOQUE
                              FROM consinco.map_familia a
                                    JOIN consinco.map_produto b
                                         ON a.seqfamilia = b.seqfamilia
                                    JOIN consinco.mrl_produtoempresa c
                                         ON b.seqproduto = c.seqproduto
                                    JOIN consinco.mlf_nfitem d
                                         ON b.seqproduto = d.seqproduto           
                                    JOIN consinco.ge_pessoa e
                                         ON d.seqpessoa = e.seqpessoa
                                    JOIN consinco.ge_empresa g
                                         ON c.nroempresa = g.nroempresa
                                    WHERE d.seqpessoa = i.seqpessoa and
                                          b.seqproduto IN (SELECT f.seqproduto
                                                             FROM consinco.mlf_nfitem f where f.seqpessoa = i.seqpessoa) and
                                          c.estqtroca <> 0
                               )
                               LOOP
                                    DBMS_OUTPUT.PUT_LINE('Empresa: ' || item.nroempresa ||
                                                   ', Pessoa: ' || item.seqpessoa ||
                                                   ', Fornecedor: ' || item.fornecedor ||
                                                   ', Produto: ' || item.seqproduto ||
                                                   ', Desc: ' || item.produto ||
                                                   ', Est. Troca: ' || item.Estoque_Troca ||
                                                   ', Vlr Estoque: ' || item.vlr_estoque);
                            END LOOP;
                END LOOP;
END;





